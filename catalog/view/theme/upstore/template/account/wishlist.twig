{{ header }}
<div class="container">
  <ul class="breadcrumb">
	 {% for i,breadcrumb in breadcrumbs %}
		{% if (i+1 < breadcrumbs|length) %}<li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li> {% else %}<li>{{ breadcrumb.text }}</li>{% endif %}
	{% endfor %}
  </ul>
  <h1>{{ heading_title }}</h1>
  {% if sel_fw_ss or sel_fw_c %}
  	<div class="fw-results">
  		{% if active_categories %}
  			{% for cat in active_categories %}
  				<div class="fw-active-cat">
  					<button class="btn btn-active-fw" type="button" data-category-id="{{ cat.category_id }}">{{ cat.name }}<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 18 18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 .999 8 8 0 0 0 9 17ZM6.707 5.293 9 7.586l2.293-2.293a1 1 0 1 1 1.414 1.414L10.414 9l2.293 2.293a1 1 0 0 1-1.414 1.414L9 10.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L7.586 9 5.293 6.707a1 1 0 0 1 1.414-1.414Z"/></svg></button>
  				</div>
  			{% endfor %}
  		{% endif %}
  		{% if sel_fw_ss == '1' %}
  			<div class="fw-active-cat">
  				<button class="btn btn-active-fw" data-stock="1" type="button">{{ text_instock }}<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 18 18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 .999 8 8 0 0 0 9 17ZM6.707 5.293 9 7.586l2.293-2.293a1 1 0 1 1 1.414 1.414L10.414 9l2.293 2.293a1 1 0 0 1-1.414 1.414L9 10.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L7.586 9 5.293 6.707a1 1 0 0 1 1.414-1.414Z"/></svg></path></svg></button>
  			</div>
  		{% endif %}
  		{% if sel_fw_ss == '2' %}
  			<div class="fw-active-cat">
  				<button class="btn btn-active-fw" data-stock="2" type="button">{{ text_out_stock }}<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 18 18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 .999 8 8 0 0 0 9 17ZM6.707 5.293 9 7.586l2.293-2.293a1 1 0 1 1 1.414 1.414L10.414 9l2.293 2.293a1 1 0 0 1-1.414 1.414L9 10.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L7.586 9 5.293 6.707a1 1 0 0 1 1.414-1.414Z"/></svg></path></svg></button>
  			</div>
  		{% endif %}
  		<div class="fw-active-cat">
  			<button class="btn btn-fw-clearall" type="button">{{ text_clear_all }}<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 18 18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 .999 8 8 0 0 0 9 17ZM6.707 5.293 9 7.586l2.293-2.293a1 1 0 1 1 1.414 1.414L10.414 9l2.293 2.293a1 1 0 0 1-1.414 1.414L9 10.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L7.586 9 5.293 6.707a1 1 0 0 1 1.414-1.414Z"/></svg></path></svg></button>
  		</div>
  	</div>
  {% endif %}
  {% if (success) %}
	<div class="alert ch-alert-success">
		<img class="success-icon" alt="success-icon" src="catalog/view/theme/upstore/image/success-icon.svg">
		<div class="text-modal-block">{{ success }}</div>
		<button type="button" class="close" data-dismiss="alert"><i class="up-icon-close" aria-hidden="true"></i></button>
	</div>
  {% endif %}
  <div class="row">
  	{% if (categories) %}
	<aside id="column-left" class="col-md-3">
		<div class="filter-wishlist" data-widget="filter-wishlist">
			<div class="fw-categories">
				<div class="fw-title">{{ text_categories }}</div>
				{% for category in categories %}
					<div class="fw-cat-group fw-level-0">
						<div class="fw-cat-item">
							<label class="fw-cat">
								<input {% if category.category_id in sel_fw_c %}checked="checked"{% endif %}id="fw_c_{{ category.category_id }}" type="checkbox" name="fw_c" autocomplete="off" value="{{ category.category_id }}" />
								<span class="fw-categoty-name">{{ category.name }}<sup id="fw_ct_{{ category.category_id }}">({{ category.total }})</sup></span>
							</label>
						{% if category.children %}<span class="fw-arrow lv-1"><i class="up-icon-angle-right" aria-hidden="true"></i></span>{% endif %}
						</div>
						{% if category.children %}
							<div class="fw-cat-list fw-level-1 d-none">
								{% for fw_level_1 in category['children'] %}
									<div class="fw-cat-group fw-level-1{% if fw_level_1.category_id in sel_fw_c%} open-list{% endif %}">
										<div class="fw-cat-item">
											<label class="fw-cat">
												<input {% if fw_level_1.category_id in sel_fw_c %}checked="checked"{% endif %}id="fw_c_{{ fw_level_1.category_id }}" type="checkbox" name="fw_c" autocomplete="off" value="{{ fw_level_1.category_id }}" />
												<span class="fw-categoty-name">{{ fw_level_1.name }}<sup id="fw_ct_{{ fw_level_1.category_id }}">({{ fw_level_1.total }})</sup></span>
											</label>
											{% if fw_level_1.children %}<span class="fw-arrow lv-2"><i class="up-icon-angle-right" aria-hidden="true"></i></span>{% endif %}
										</div>
										{% if fw_level_1.children %}
											<div class="fw-cat-list fw-level-2 d-none">
												{% for fw_level_2 in fw_level_1['children'] %}
													<div class="fw-cat-group fw-level-2{% if fw_level_2.category_id in sel_fw_c %} open-list{% endif %}">
														<div class="fw-cat-item">
															<label class="fw-cat">
																<input {% if fw_level_2.category_id in sel_fw_c %}checked="checked"{% endif %}id="fw_c_{{ fw_level_2.category_id }}" type="checkbox" name="fw_c" autocomplete="off" value="{{ fw_level_2.category_id }}" />
																<span class="fw-categoty-name">{{ fw_level_2.name }}<sup id="fw_ct_{{ fw_level_2.category_id }}">({{ fw_level_2.total }})</sup></span>
															</label>
														</div>
													</div>
												{% endfor %}
											</div>
										{% endif %}
									</div>
								{% endfor %}
							</div>
						{% endif %}
					</div>
				{% endfor %}
			</div>
			<div class="fw-stock-status">
				<div class="fw-title">{{ text_stock_status }}</div>
				<div class="fw-stock-group">
					<div class="fw-stock-item">
						<label class="fw-radio">
							<input {% if sel_fw_ss is empty %}checked="checked"{% endif %} autocomplete="off" type="radio" name="fw_ss" value="" />
							<span class="fw-name">{{ text_all_status }}</span>
						</label>
					</div>
					<div class="fw-stock-item">
						<label class="fw-radio">
							<input id="fw_ss_1" {% if sel_fw_ss == '1' %}checked="checked"{% endif %} autocomplete="off" type="radio" name="fw_ss" value="1" />
							<span class="fw-name">{{ text_instock }}</span>
						</label>
					</div>
					<div class="fw-stock-item">
						<label class="fw-radio">
							<input id="fw_ss_2" {% if sel_fw_ss == '2' %}checked="checked"{% endif %} autocomplete="off" type="radio" name="fw_ss" value="2" />
							<span class="fw-name">{{ text_out_stock }}</span>
						</label>
					</div>
				</div>
			</div>
		</div>
	</aside>
	<script>
		$(document).on('click', '.fw-categories .fw-arrow', function() {
			var fw_list	= $(this).parent().next();

			if(fw_list.hasClass('open-list')) {
				fw_list.slideUp(120).removeClass('open-list');
				$(this).removeClass('fw-open');
			} else {
				fw_list.slideDown(150, function() {
					fw_list.addClass('open-list');
				});
				$(this).addClass('fw-open');
			}
		});

		$('.fw-cat-group.fw-level-1').each(function (index, value) {
			if($(this).hasClass('open-list')){
				$(this).parent().removeClass('d-none');
			}
		});

		$('.fw-cat-group.fw-level-2').each(function (index, value) {
			if($(this).hasClass('open-list')){
				$(this).parent().removeClass('d-none');
			}
		});

		$(document).on('click', '.btn-active-fw', function(e) {
			if($(this).attr('data-category-id')){
				$('.filter-wishlist').find('input#fw_c_' + $(this).attr('data-category-id')).prop('checked', false).removeAttr('checked');
			}
			if($(this).attr('data-stock')){
				$('.filter-wishlist').find('input#fw_ss_' + $(this).attr('data-stock')).prop('checked', false).removeAttr('checked');
			}
			filterWishlist();
		});

		$(document).on('click', '.btn-fw-clearall', function(e) {
			e.stopPropagation();
			$('.filter-wishlist').find('input').prop('checked', false).removeAttr('checked');
			filterWishlist();
		});

		function filterWishlist(){
			url = 'index.php?route=account/wishlist';

			var fw = {};
			var fw_inputs = $('.filter-wishlist').find('input[type=\'radio\']:checked, input[type=\'checkbox\']:checked').serializeArray();

			$(fw_inputs).each(function (i, field) {
				var name = field.name;
				var value = encodeURIComponent(field.value);
				if(value !=''){
					fw[name] = fw[name] || [];
					fw[name].push(value);
				}
			});

			var url_data = []
			$.each(fw, function (k, v) {
				url_data.push(k + ':' + v.join(','));
			});

			url_data = url_data.join(';');
			if(url_data){
				url += '&fw=' + url_data;
			}
			location = url;
		}

		$(document).on('change', '.filter-wishlist input', function(e) {
			filterWishlist();
		});
	</script>
	{% endif %}
	{% if column_left and column_right %}
		{% set class = 'col-md-6' %}
	{% elseif column_left or column_right %}
		{% if (products) %}
			{% set class = 'col-md-6' %}
		{% else %}
			{% set class = 'col-md-9' %}
		{% endif %}
	{% else %}
		{% set class = 'col-md-12' %}
	{% endif %}
	<div id="content" class="{{ class }} ns-smv mt-0">
		{{ content_top }}
	  {% if (products) %}
	  	<div class="row-flex category-page">
	  		{% for product in products %}
	  		<div class="wl-product-layout product-grid col-xs-6 col-sm-6 col-md-4 col-lg-4">
					<div class="product-thumb dflex flex-column h-100">
						<div class="image">
							{% if (ns_on_off_category_page_rating is defined and (ns_on_off_category_page_rating == '1')) %}
								{% if product.rating > 0 %}
									<div class="rating"><span class="product-rating-star">{{ product.rating }}</span></div>
								{% endif %}
							{% endif %}
							<div class="stickers-ns">
								{% if ((on_off_sticker_special == '1') and product.special) %}
									<div class="sticker-ns special">
										{% if (config_change_icon_sticker_special is not empty) %}<i class="fa {{ config_change_icon_sticker_special }} "></i>{% endif %}
										{{ text_sticker_special[lang_id].config_change_text_sticker_special }}
									</div>
								{% endif %}
								{% if ((on_off_sticker_topbestseller == '1') and (product.top_bestsellers >= config_limit_order_product_topbestseller)) %}
									<div class="sticker-ns bestseller">
										{% if (config_change_icon_sticker_topbestseller is not empty) %}<i class="fa {{ config_change_icon_sticker_topbestseller }} "></i>{% endif %}
										{{ text_sticker_topbestseller[lang_id].config_change_text_sticker_topbestseller }}
									</div>
								{% endif %}
								{% if ((on_off_sticker_popular == '1') and (product.viewed>=config_min_quantity_popular)) %}
									<div class="sticker-ns popular">
										{% if (config_change_icon_sticker_popular is not empty) %}<i class="fa {{ config_change_icon_sticker_popular }} "></i>{% endif %}
										{{ text_sticker_popular[lang_id].config_change_text_sticker_popular }}
									</div>
								{% endif %}
								{% if ((on_off_sticker_newproduct == '1') and product.sticker_new_prod ) %}
									<div class="sticker-ns newproduct">
										{% if (config_change_icon_sticker_newproduct is not empty) %}<i class="fa {{ config_change_icon_sticker_newproduct }}"></i>{% endif %}
										{{ text_sticker_newproduct[lang_id].config_change_text_sticker_newproduct }}
									</div>
								{% endif %}
							</div>
							<a {% if product.image_hm %}class="gallery-images"{% endif %} href="{{ product.href }}">
								<img class="img-responsive{% if product.image_hm%} ch-g-image active-image{% endif %}" {% if product.image_h %}data-additional-hover="{{ product.image_h }}"{% endif %} decoding="async" width="{{ product.width }}" height="{{ product.height }}" loading="lazy" src="{{ product.thumb }}" alt="{{ product.name }}" />
								{% if product.image_hm %}
									<div class="ch-g-items">
										{% set line = '' %}
										{% for dop_image in product.image_hm %}
											<img class="ch-g-image img-responsive" decoding="async" width="{{ product.width }}" height="{{ product.height }}" loading="lazy" data-src="{{ dop_image }}" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="{{ product.name }}" />
											{% set line = line ~'<div class="ch-g-line"></div>' %}
										{% endfor %}
									</div>
									<div class="ch-g-dots">
										<div class="ch-g-line active-line"></div>
										{{ line }}
									</div>
								{% endif %}
							</a>
							{% if (show_special_timer_page == '1' and product.special) %}
								<div class="action-timer" data-date-end="{{ product.date_end }}"></div>
							{% endif %}
							<div class="addit-action">
								{% if (config_on_off_category_page_quickview == '1') %}
									<div class="quickview"><button class="btn btn-quickview" title="{{ config_quickview_btn_name[lang_id].config_quickview_btn_name }}" onclick="quickview_open({{ product.product_id}});"><i class="up-icon-quickview" aria-hidden="true"></i></button></div>
								{% endif %}
								{% if us_setting_pages.status_fastorder is defined and us_setting_pages.status_fastorder == 1 and product.show_buy_button %}
									{% if ((not disable_fastorder_button and ((product.product_quantity <= 0) or product.product_quantity > 0)) or (disable_fastorder_button and product.product_quantity > 0)) %}
									<div class="quick-order">
									<button class="btn btn-fastorder" title="{{ config_text_open_form_send_order[lang_id].config_text_open_form_send_order }}" type="button" onclick="fastorder_open({{ product.product_id}});" {% if ((product.product_quantity <= 0) and disable_fastorder_button) %}disabled{% endif %}>
										<i class="up-icon-fastorder" aria-hidden="true"></i>
									</button>
								  </div>
								{% endif %}
								{% endif %}
								{% if us_setting_pages.status_compare is defined and us_setting_pages.status_compare == 1 %}
									<div class="compare"><button class="btn btn-compare" type="button" title="{{ button_compare }}" onclick="compare.add('{{ product.product_id }}');"><i class="up-icon-compare" aria-hidden="true"></i></button></div>
								{% endif %}
								{% if us_setting_pages.status_wishlist is defined and us_setting_pages.status_wishlist == 1 %}
									<div class="wishlist"><button class="btn btn-wishlist" type="button" title="{{ button_wishlist }}" onclick="wishlist.add('{{ product.product_id }}');"><i class="up-icon-wishlist" aria-hidden="true"></i></button></div>
								{% endif %}
							</div>
	  					</div>
	  					<div class="caption dflex flex-column flex-grow-1">
							<div class="product-name"><a href="{{ product.href }}">{{ product.name }}</a></div>
							{% if us_setting_pages.status_rating is defined and us_setting_pages.status_rating == 1 %}
								<div class="rating mb-10 d-flex align-items-center">
									<div class="rating-stars d-flex align-items-center">
										{% for star_width in product.rating_stars %}
											<div class="rating-star up-icon">
												<div class="rating-star-active up-icon" style="width:{{ star_width }}%"></div>
											</div>
										{% endfor %}
									</div>
									{% if us_setting_pages.status_quantity_reviews is defined and us_setting_pages.status_quantity_reviews == 1 %}
										<div class="product-reviews d-flex align-items-center">
											<i class="up-icon-18 up-icon-message" aria-hidden="true"></i>
											{% if product.reviews > 0 %}
												<span class="total-reviews d-flex align-items-center justify-content-center">{{ product.reviews }}</span>
											{% endif %}
										</div>
									{% endif %}
								</div>
							{% endif %}
							{% if us_setting_pages.status_model is defined and us_setting_pages.status_model == 1 or show_stock_status %}
								<div class="product_model_sstatus mb-10 justify-content-between dflex">
									{% if us_setting_pages.status_model is defined and us_setting_pages.status_model == 1 %}
										<div class="product-model">{{ text_model }}{{ product.model }}</div>
									{% endif %}
									{% if show_stock_status %}
										{% if product.product_quantity <= 0 %}
											<div class="stock-status outofstock">{{ product.stock_status }}</div>
										{% else %}
											<div class="stock-status up-icon instock">
												{{ text_instock }}
											</div>
										{% endif %}
									{% endif %}
								</div>
							{% endif %}
							{% if us_setting_pages.status_description is defined and us_setting_pages.status_description == 1 %}
								<div class="product-description">{{ product.description }}</div>
							{% endif %}
							<div class="price-actions-box dflex flex-wrap mt-auto">
								{% if (product.price) %}
									{% if (config_additional_settings_upstore.quantity_btn_page is defined and (config_additional_settings_upstore.quantity_btn_page == '1') and product.show_buy_button) %}
										<div class="quantity_plus_minus">
											<span class="add-up add-action">
												<svg xmlns="http://www.w3.org/2000/svg" width="7" height="5" fill="none" viewBox="0 0 7 5">
													<path fill="#000" fill-rule="evenodd" d="M3.826 2.144a.5.5 0 00-.707.004L.856 4.438a.5.5 0 01-.712-.704l2.264-2.289a1.5 1.5 0 012.121-.012L6.852 3.73a.5.5 0 11-.704.711L3.826 2.144z" clip-rule="evenodd"/>
												</svg>
											</span>
											<input type="text" class="quantity-num form-control" name="quantity" value="{{ product.minimum }}" data-minimum="{{ product.minimum }}"  {% if (config_additional_settings_upstore.quantity_multiple is defined and (config_additional_settings_upstore.quantity_multiple == '1') and product.minimum > 1) %}disabled{% endif %}>
											<span class="add-down add-action">
												<svg xmlns="http://www.w3.org/2000/svg" width="7" height="5" fill="none" viewBox="0 0 7 5">
													<path fill="#000" fill-rule="evenodd" d="M3.174 2.856a.5.5 0 00.707-.004L6.144.562a.5.5 0 01.712.704L4.592 3.555a1.5 1.5 0 01-2.121.012L.148 1.27A.5.5 0 11.852.559l2.322 2.297z" clip-rule="evenodd"/>
												</svg>
											</span>
										</div>
									{% endif %}
									<div class="price" data-price-value="{{ product.price_value }}" data-special-value="{{ product.special_value }}">
									{% if (not product.special) %}
									<span class="price_value">{{ product.price }}</span>
									{% else %}
									<span class="price-old"><span class="price_value">{{ product.price }}</span>
									{% if ((on_off_percent_discount == '1') and product.special) %}<span class="sticker-ch-pd procent-skidka">{{ product.skidka }} %</span>{% endif %}</span>
									<span class="price-new"><span class="special_value">{{ product.special }}</span></span>
									{% endif %}
									{% if (product.tax) %}
									<span class="price-tax">{{ text_tax }} {{ product.tax }}</span>
									{% endif %}
									</div>
								{% endif %}
								<div class="cart">
									{% if (product.show_buy_button) %}
										<button aria-label="Add to cart" class="btn btn-general {{ ch_type_btn }} {% if product.in_cart %} is-active{% endif %}" type="button" {% if ((product.product_quantity <= 0) and disable_cart_button) %}disabled{% else %}onclick="cart.add('{{ product.product_id }}',this)"{% endif %}><i class="up-icon-22 up-icon-cart" aria-hidden="true"></i><span class="text-cart-add">{% if (change_text_cart_button_out_of_stock == 1 and product.product_quantity <= 0) %}{{ disable_cart_button_text }}{% else %}{% if product.in_cart %}{{ text_in_cart }}{% else %}{{ button_cart }}{% endif %}{% endif %}</span></button>
									{% else %}
										<button aria-label="notify stock" class="btn btn-general {{ ch_type_btn }}{% if product.in_waitlist %} is-active{% endif %}" type="button" onclick="upstoreNotifyStock('{{ product['product_id'] }}');"><i class="up-icon-22 up-icon-notify" aria-hidden="true"></i><span class="text-cart-add">{{ button_notify_stock }}</span></button>
									{% endif %}
								</div>
	  						</div>
	  					</div>
	  				</div>
	  		</div>
	  		{% endfor %}
	  	</div>
	  {% else %}
	  <p>{{ text_empty }}</p>
	  {% endif %}
	  {{ content_bottom }}</div>
	{{ column_right }}</div>
</div>
{{ footer }}