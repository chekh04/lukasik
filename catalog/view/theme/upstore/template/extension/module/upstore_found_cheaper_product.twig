<div id="popup-found-cheaper" class="modal-dialog chm-modal sm-modal-4 modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">
                {{ fcpdata.title_popup_found_cheaper[lang_id].text is not empty ? fcpdata.title_popup_found_cheaper[lang_id].text : '' }}
            </div>
            <button type="button" class="close-modal" data-dismiss="modal"><i class="up-icon-close" aria-hidden="true"></i></button>
        </div>
        <div class="modal-body">
            {% if fcpdata.found_cheaper_info_text[lang_id].text is not empty %}
                <div class="info-text-found-cheaper">
                    {{ fcpdata.found_cheaper_info_text[lang_id].text|raw }}
                </div>
            {% endif %}
            <form id="form-found-cheaper" method="post" enctype="multipart/form-data">
                <div class="form-group hidden">
                    <input type="hidden" name="fcp_product_id" value="{{ product_id }}" />
                    <input type="hidden" name="token_csrf" value="{{ csrf_token }}" />
                </div>
                {% if fcpdata.name_field %}
                    <div class="form-group {{ fcpdata.name_field_required == '1' ? 'field_required' : '' }}">
                        <div class="input-group-flex">
                            <div class="input-group-icon">
                                <img src="catalog/view/theme/upstore/image/form-icon/name-icon.svg" alt="" />
                            </div>
                            <input id="contact-name" class="form-control contact-name" type="text" placeholder="{{ fcpdata.name_field_placeholder[lang_id].text }}" value="{{ name_field }}" name="name_field" />
                        </div>
                    </div>
                {% endif %}
                {% if fcpdata.telephone_field %}
                    <div class="form-group {{ fcpdata.telephone_field_required == '1' ? 'field_required' : '' }}">
                        <div class="input-group-flex">
                            <div class="input-group-icon">
                                <img src="catalog/view/theme/upstore/image/form-icon/tel-icon.svg" alt="" />
                            </div>
                            <input id="contact-telephone" class="form-control contact-telephone" type="text" placeholder="{{ fcpdata.telephone_field_placeholder[lang_id].text }}" value="{{ telephone_field }}" name="telephone_field" />
                        </div>
                    </div>
                {% endif %}
                {% if fcpdata.email_field %}
                    <div class="form-group {{ fcpdata.email_field_required == '1' ? 'field_required' : '' }}">
                        <div class="input-group-flex">
                            <div class="input-group-icon">
                                <img src="catalog/view/theme/upstore/image/form-icon/email-icon.svg" alt="" />
                            </div>
                            <input id="contact-email" class="form-control contact-email" type="text" placeholder="{{ fcpdata.email_field_placeholder[lang_id].text }}" value="{{ email_field }}" name="email_field" />
                        </div>
                    </div>
                {% endif %}
                {% if fcpdata.link_field %}
                    <div class="form-group {{ fcpdata.link_field_required == '1' ? 'field_required' : '' }}">
                        <div class="input-group-flex">
                            <div class="input-group-icon">
                                <img src="catalog/view/theme/upstore/image/form-icon/link-icon.svg" alt="" />
                            </div>
                            <input id="contact-link" class="form-control contact-link" type="text" placeholder="{{ fcpdata.link_field_placeholder[lang_id].text }}" value="" name="link_field" />
                        </div>
                    </div>
                {% endif %}
                {% if fcpdata.comment_field %}
                    <div class="form-group {{ fcpdata.comment_field_required == '1' ? 'required_field' : '' }}">
                        <textarea rows="3" id="contact-comment" class="form-control contact-comment" type="text" placeholder="{{ fcpdata.comment_field_placeholder[lang_id].text }}" name="comment_field"></textarea>
                    </div>
                {% endif %}
                {% if text_agree is not empty %}
                    <div class="form-group">
                        <label class="chm-checkbox mb-0">
                            <input class="checkbox-input" type="checkbox" name="agree" value="1" />
                            <span class="checkbox-check"></span>{{ text_agree }}
                        </label>
                        <div class="error_agree"></div>
                    </div>
                {% endif %}
            </form>
        </div>
        <div class="modal-footer">
            <button id="up-btn-found-cheaper" class="chm-btn chm-btn-primary chm-px-lg chm-lg-rounded w-100" type="button" onclick="found_cheaper_product_confirm()">{{ button_send_found_cheaper }}</button>
        </div>
        {% if fcpdata.telephone_field_mask != '' %}
            <script src="catalog/view/theme/upstore/js/maskedinput.js" type="text/javascript"></script>
            <script>
                $(".contact-telephone").mask('{{ fcpdata.telephone_field_mask }}');
            </script>
        {% endif %}
        <script>
        function found_cheaper_product_confirm() {
            $.ajax({
                url: 'index.php?route=extension/module/upstore_found_cheaper_product/found_cheaper_product_confirm',
                type: 'post',
                data: $('#form-found-cheaper').serialize() + '&action=send',
                dataType: 'json',
                beforeSend: function() {
                    creatOverlayLoadPage(true);
                    $('#up-btn-found-cheaper').data('original-content', $('#up-btn-found-cheaper').html());
                    $('#up-btn-found-cheaper').html('<i class="fa fa-spinner fa-spin"></i>').prop('disabled', true);
                },
                complete: function() {
                    setTimeout(function () {
                        creatOverlayLoadPage(false);
                        $('#up-btn-found-cheaper').html($('#up-btn-found-cheaper').data('original-content')).prop('disabled', false);
                    }, 300);
                },
                success: function(json) {
                    $('#popup-found-cheaper .form-control').removeClass('error_input');
                    $('#popup-found-cheaper .form-control').removeClass('success_input');
                    $('#popup-found-cheaper').find('.us-error-agree').removeClass('us-error-agree');
                    $('.alert.ch-alert-danger,.us-success-icon,.us-error-icon,.us-text-error').remove();

                    if (json['error']) {
                        handleFieldNotifications('#modal-found-cheaper', json['error']);
                    }

                    if (json['success']){
                        $('#modal-found-cheaper').modal('hide');

                        showModalWithMessage(json['success']);

                        $(document).on('hide.bs.modal', '#modal-found-cheaper.modal.fade', function () {
                            $('#modal-found-cheaper').remove();
                        });

                    }
                }
            });
        }
        </script>
    </div>
</div>
